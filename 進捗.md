# SNS ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é–‹ç™ºã¾ã¨ã‚

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

TypeScript + Next.js + Express + PostgreSQL + Docker ã§æ§‹ç¯‰ã™ã‚‹ SNS ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®é–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Next.js 14 + TypeScript + Tailwind CSS
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Express + TypeScript + Prisma ORM
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: PostgreSQL 15
- **ã‚³ãƒ³ãƒ†ãƒŠ**: Docker + Docker Compose
- **é–‹ç™ºç’°å¢ƒ**: Linux (Ubuntu)

---

## ç¾åœ¨ã®é€²æ—çŠ¶æ³

### âœ… å®Œäº†æ¸ˆã¿é …ç›®

#### 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```
sns-platform/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ frontend/                   # Next.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ src/app/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ next.config.js
â”œâ”€â”€ backend/                    # Express APIã‚µãƒ¼ãƒãƒ¼
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â””â”€â”€ prisma.ts      âœ… å®Œæˆ
â”‚   â”‚   â”œâ”€â”€ controllers/       âœ… userController.ts å®Œå…¨å®Ÿè£…æ¸ˆã¿
â”‚   â”‚   â”œâ”€â”€ routes/            # ä½œæˆæ¸ˆã¿ï¼ˆç©ºï¼‰
â”‚   â”‚   â”œâ”€â”€ types/             âœ… user.ts å®Œå…¨å®Ÿè£…æ¸ˆã¿
â”‚   â”‚   â””â”€â”€ server.ts          âœ… å®Œæˆ
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”œâ”€â”€ schema.prisma      âœ… å®Œæˆ
â”‚   â”‚   â”œâ”€â”€ migrations/        âœ… å®Œæˆ
â”‚   â”‚   â””â”€â”€ seed.js           âœ… å®Œæˆ
â”‚   â””â”€â”€ package.json
```

#### 2. Docker ç’°å¢ƒ

- PostgreSQL ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ¸ˆã¿
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ `snsplatform` ä½œæˆæ¸ˆã¿
- ãƒ¦ãƒ¼ã‚¶ãƒ¼: `snsuser` / ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: `snspassword`

#### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆï¼ˆPrisma ã‚¹ã‚­ãƒ¼ãƒï¼‰

- User, Post, Follow, Like, Comment, PostImage ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆå®Œäº†
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ¸ˆã¿
- ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æŠ•å…¥æ¸ˆã¿ï¼ˆAlice, Bob ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ + æŠ•ç¨¿ + ãƒ•ã‚©ãƒ­ãƒ¼ + ã„ã„ã­ï¼‰

#### 4. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰åŸºç›¤

- Express ã‚µãƒ¼ãƒãƒ¼è¨­å®šå®Œäº†
- Prisma ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®šå®Œäº†
- TypeScript è¨­å®šå®Œäº†
- **userController.ts å®Œå…¨å®Ÿè£…æ¸ˆã¿ âœ¨**
- **å‹å®šç¾©ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨å®Ÿè£…æ¸ˆã¿ âœ¨**

---

## å‹å®šç¾©ã‚·ã‚¹ãƒ†ãƒ  ğŸ¯

### å®Ÿè£…æ¸ˆã¿å‹å®šç¾©ï¼ˆbackend/src/types/user.tsï¼‰

#### Core Types

```typescript
// åŸºæœ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼å‹ï¼ˆå†…éƒ¨å‡¦ç†ç”¨ï¼‰
export interface User {
  id: string;
  email: string;
  username: string;
  displayName: string;
  bio: string | null; // Prismaã‚¹ã‚­ãƒ¼ãƒã¨ä¸€è‡´
  profileImageUrl: string | null;
  createdAt: Date;
  updatedAt: Date;
}

// å…¬é–‹ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å‹ï¼ˆemailé™¤å¤–ï¼‰
export interface PublicUser {
  id: string;
  username: string;
  displayName: string;
  bio: string | null;
  profileImageUrl: string | null;
  createdAt: Date;
  updatedAt: Date;
}

// çµ±è¨ˆæƒ…å ±å‹
export interface UserCount {
  posts: number;
  followers: number;
  following?: number; // getAllUsersã§ã¯çœç•¥
}
```

#### Request/Response Types

```typescript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‹
export interface CreateUserRequest {
  email: string;
  username: string;
  displayName: string;
  bio?: string | null;
  profileImageUrl?: string | null;
}

export interface UpdateUserRequest {
  displayName?: string;
  bio?: string | null;
  profileImageUrl?: string | null;
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹
export interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
  message?: string;
}

export interface GetUsersResponse
  extends ApiResponse<PaginatedResponse<PublicUserWithCount>> {}
export interface GetUserResponse
  extends ApiResponse<User & { _count: UserCount }> {}
export interface CreateUserResponse extends ApiResponse<User> {
  message: string;
}
```

#### Type Guards

```typescript
export function isCreateUserRequest(obj: unknown): obj is CreateUserRequest;
export function isUpdateUserRequest(obj: unknown): obj is UpdateUserRequest;
```

---

## User API ä»•æ§˜

### åŸºæœ¬æƒ…å ±

- Base URL: `http://localhost:8000/api`
- Content-Type: `application/json`
- èªè¨¼: æœªå®Ÿè£…ï¼ˆå¾Œã§ JWT å®Ÿè£…äºˆå®šï¼‰

### å®Ÿè£…æ¸ˆã¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ

```http
POST /api/users
```

**ç‰¹å¾´:**

- Type Guard ã«ã‚ˆã‚‹å‹å®‰å…¨ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- Prisma ã‚¨ãƒ©ãƒ¼ï¼ˆP2002ï¼‰ã®è©³ç´°å‡¦ç†
- å…¥åŠ›å€¤ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆtrimï¼‰

**Request Body:**

```json
{
  "email": "user@example.com",
  "username": "johndoe",
  "displayName": "John Doe",
  "bio": "Hello, I'm John!" // optional
}
```

**Response (201 Created):**

```json
{
  "success": true,
  "data": {
    "id": "clxxx123456789",
    "email": "user@example.com",
    "username": "johndoe",
    "displayName": "John Doe",
    "bio": "Hello, I'm John!",
    "profileImageUrl": null,
    "createdAt": "2024-01-15T10:30:00.000Z",
    "updatedAt": "2024-01-15T10:30:00.000Z"
  },
  "message": "User created successfully"
}
```

#### 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—

```http
GET /api/users/:id
```

**ç‰¹å¾´:**

- å®Œå…¨ãªå‹å®‰å…¨æ€§ï¼ˆRequest/Response å‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
- null ãƒã‚§ãƒƒã‚¯å¾Œã®å‹çµã‚Šè¾¼ã¿
- çµ±è¨ˆæƒ…å ±ï¼ˆfollowing å«ã‚€ï¼‰ã®å–å¾—

**Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "id": "clxxx123456789",
    "email": "user@example.com",
    "username": "johndoe",
    "displayName": "John Doe",
    "bio": "Hello, I'm John!",
    "profileImageUrl": null,
    "createdAt": "2024-01-15T10:30:00.000Z",
    "updatedAt": "2024-01-15T10:30:00.000Z",
    "_count": {
      "posts": 5,
      "followers": 10,
      "following": 8
    }
  }
}
```

#### 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—ï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰

```http
GET /api/users?page=1&limit=10
```

**ç‰¹å¾´:**

- å®‰å…¨ãªã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‡¦ç†ï¼ˆç¯„å›²ãƒã‚§ãƒƒã‚¯ä»˜ãï¼‰
- ä¸¦åˆ—å‡¦ç†ã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿å–å¾—
- email ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é™¤å¤–ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰
- following çµ±è¨ˆã¯çœç•¥ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼‰

**Response (200 OK):**

```json
{
  "success": true,
  "data": {
    "data": [
      {
        "id": "clxxx123456789",
        "username": "johndoe",
        "displayName": "John Doe",
        "bio": "Hello, I'm John!",
        "profileImageUrl": null,
        "createdAt": "2024-01-15T10:30:00.000Z",
        "updatedAt": "2024-01-15T10:30:00.000Z",
        "_count": {
          "posts": 5,
          "followers": 10
        }
      }
    ],
    "pagination": {
      "currentPage": 1,
      "totalPages": 5,
      "totalItems": 50,
      "hasNext": true,
      "hasPrev": false
    }
  }
}
```

#### 4. ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±æ›´æ–°

```http
PUT /api/users/:id
```

**ç‰¹å¾´:**

- éƒ¨åˆ†æ›´æ–°å¯¾å¿œï¼ˆundefined ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯æ›´æ–°ã—ãªã„ï¼‰
- Type Guard ã«ã‚ˆã‚‹å®‰å…¨ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ç©ºãƒ‡ãƒ¼ã‚¿ãƒã‚§ãƒƒã‚¯

**Request Body:**

```json
{
  "displayName": "John Smith", // optional
  "bio": "Updated bio", // optional
  "profileImageUrl": "https://example.com/image.jpg" // optional
}
```

#### 5. ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤

```http
DELETE /api/users/:id
```

**ç‰¹å¾´:**

- Prisma ã‚¨ãƒ©ãƒ¼ï¼ˆP2025ï¼‰ã®é©åˆ‡ãªå‡¦ç†
- å‹å®‰å…¨ãªã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹

**Response (200 OK):**

```json
{
  "success": true,
  "message": "User deleted successfully"
}
```

### ä»Šå¾Œå®Ÿè£…äºˆå®šã® API

#### SNS æ©Ÿèƒ½

- `GET /api/users/search?q=john` - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢
- `GET /api/users/:id/followers` - ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ä¸€è¦§
- `GET /api/users/:id/following` - ãƒ•ã‚©ãƒ­ãƒ¼ä¸­ä¸€è¦§
- `GET /api/users/:id/posts` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¨¿ä¸€è¦§
- `GET /api/users/:id/likes` - ã„ã„ã­ã—ãŸæŠ•ç¨¿ä¸€è¦§

---

## å®Ÿè£…ã®ç‰¹å¾´ãƒ»ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ğŸ”’ å‹å®‰å…¨æ€§

#### å®Œå…¨ãªå‹ã‚·ã‚¹ãƒ†ãƒ 

```typescript
// Request/Response ã®å‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŒ‡å®š
export const createUser = async (
  req: Request<{}, CreateUserResponse, CreateUserRequest>,
  res: Response<CreateUserResponse>
): Promise<void> => {
```

#### Type Guards ã®æ´»ç”¨

```typescript
// ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å‹ãƒã‚§ãƒƒã‚¯
if (!isCreateUserRequest(req.body)) {
  const errorResponse: CreateUserResponse = {
    success: false,
    error: "Invalid request body format",
  };
  res.status(400).json(errorResponse);
  return;
}
```

#### null è¨±å®¹æ€§ã®é©åˆ‡ãªå‡¦ç†

```typescript
// Prismaã‚¹ã‚­ãƒ¼ãƒã¨ã®ä¸€è‡´
bio: string | null; // âœ… Prismaã® String? ã¨ä¸€è‡´
profileImageUrl: string | null; // âœ… Prismaã® String? ã¨ä¸€è‡´
```

### ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

#### DoS æ”»æ’ƒé˜²æ­¢

```typescript
// limit ã®ä¸Šé™è¨­å®š
const limit = Math.min(
  Math.max(1, parseInt(req.query.limit || "10", 10) || 10),
  50
);
```

#### æ©Ÿå¯†æƒ…å ±ä¿è­·

```typescript
// getAllUsers ã§ã¯ email ã‚’é™¤å¤–
select: {
  id: true,
  username: true,
  displayName: true,
  bio: true,
  profileImageUrl: true,
  createdAt: true,
  updatedAt: true,
  // email: true,  â† æ„å›³çš„ã«é™¤å¤–
```

#### å…¥åŠ›å€¤ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
// trim() ã«ã‚ˆã‚‹ç©ºç™½é™¤å»
email: email.trim(),
username: username.trim(),
displayName: displayName.trim(),
```

### âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

#### ä¸¦åˆ—å‡¦ç†

```typescript
const [users, totalCount] = await Promise.all([
  prisma.user.findMany({...}),
  prisma.user.count(),
]);
```

#### é¸æŠçš„å–å¾—

```typescript
// å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿å–å¾—
select: {
  id: true,
  username: true,
  // ãã®ä»–å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿
},
```

#### åŠ¹ç‡çš„ãªãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³

```typescript
skip: (page - 1) * limit,
take: limit,
```

### ğŸš¨ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### Prisma ã‚¨ãƒ©ãƒ¼ã®è©³ç´°å‡¦ç†

```typescript
if (prismaError.code === "P2002") {
  const target = prismaError.meta?.target?.[0] || "field";
  const fieldName = target === "email" ? "Email" : "Username";

  const errorResponse: CreateUserResponse = {
    success: false,
    error: `${fieldName} already exists`,
  };
  res.status(409).json(errorResponse);
  return;
}
```

#### å‹å®‰å…¨ãªã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```typescript
const errorResponse: GetUserResponse = {
  success: false,
  error: "User not found",
};
res.status(404).json(errorResponse);
```

---

## ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰å®Ÿè£…çŠ¶æ³

### userController.ts ã®å®Ÿè£…å†…å®¹

#### 1. getAllUsers

- **å‹å®‰å…¨æ€§**: å®Œå…¨ãªå‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŒ‡å®š
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: email é™¤å¤–ã€limit ä¸Šé™è¨­å®š
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ä¸¦åˆ—å‡¦ç†ã€é¸æŠçš„å–å¾—
- **æ©Ÿèƒ½**: ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚½ãƒ¼ãƒˆï¼ˆcreatedAt descï¼‰

#### 2. getUserById

- **å‹å®‰å…¨æ€§**: null ãƒã‚§ãƒƒã‚¯å¾Œã®å‹çµã‚Šè¾¼ã¿
- **æ©Ÿèƒ½**: çµ±è¨ˆæƒ…å ±å–å¾—ï¼ˆposts, followers, followingï¼‰
- **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: 404 ãƒ¬ã‚¹ãƒãƒ³ã‚¹

#### 3. createUser

- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: Type Guardã€å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: å…¥åŠ›å€¤ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: Prisma é‡è¤‡ã‚¨ãƒ©ãƒ¼è©³ç´°å‡¦ç†

#### 4. updateUser

- **æ©Ÿèƒ½**: éƒ¨åˆ†æ›´æ–°å¯¾å¿œ
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: ç©ºãƒ‡ãƒ¼ã‚¿ãƒã‚§ãƒƒã‚¯
- **å‹å®‰å…¨æ€§**: Type Guard æ´»ç”¨

#### 5. deleteUser

- **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: P2025 ã‚¨ãƒ©ãƒ¼é©åˆ‡ãªå‡¦ç†
- **å‹å®‰å…¨æ€§**: å‹å®‰å…¨ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹ç¯‰

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ 

### ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«

#### User ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
- id (String, PK, CUID)
- email (String, Unique)
- username (String, Unique)
- displayName (String)
- bio (String, Optional, nullè¨±å®¹)
- profileImageUrl (String, Optional, nullè¨±å®¹)
- createdAt (DateTime)
- updatedAt (DateTime)
```

#### Post ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
- id (String, PK, CUID)
- userId (String, FK -> User.id)
- content (String, 280æ–‡å­—åˆ¶é™)
- createdAt (DateTime)
- updatedAt (DateTime)
- deletedAt (DateTime, Optional)
```

#### Follow ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
- id (String, PK, CUID)
- followerId (String, FK -> User.id)
- followingId (String, FK -> User.id)
- createdAt (DateTime)
- UNIQUE(followerId, followingId)
```

#### Like ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
- id (String, PK, CUID)
- userId (String, FK -> User.id)
- postId (String, FK -> Post.id)
- createdAt (DateTime)
- UNIQUE(userId, postId)
```

---

## æ¬¡ã®å®Ÿè£…äºˆå®š

### ğŸ”„ ç¾åœ¨ã®æœ€å„ªå…ˆã‚¿ã‚¹ã‚¯

1. **ãƒ«ãƒ¼ãƒˆå®šç¾©ã®å®Ÿè£…**

   - `backend/src/routes/users.ts`
   - userController ã®å„é–¢æ•°ã‚’ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«æ¥ç¶š

2. **ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒ«ãƒ¼ãƒˆæ¥ç¶š**

   - `backend/src/server.ts`ã®æ›´æ–°
   - `/api/users`ãƒ«ãƒ¼ãƒˆã®è¿½åŠ 

3. **API å‹•ä½œç¢ºèª**
   - Postman ã‚„ curl ã§ã®å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
   - å‹å®‰å…¨æ€§ã®å®Ÿåƒç¢ºèª

### ğŸš€ ä»Šå¾Œã®å®Ÿè£…äºˆå®š

#### Phase 1: åŸºæœ¬ API å®Ÿè£…

- [ ] Post Controller (æŠ•ç¨¿ CRUD)
- [ ] Follow Controller (ãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½)
- [ ] Like Controller (ã„ã„ã­æ©Ÿèƒ½)
- [ ] Comment Controller (ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½)

#### Phase 2: èªè¨¼æ©Ÿèƒ½

- [ ] JWT èªè¨¼ã®å®Ÿè£…
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½
- [ ] ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢èªè¨¼

#### Phase 3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

- [ ] Next.js + TailwindCSS ã§ã® UI å®Ÿè£…
- [ ] API é€£æº
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ï¼ˆWebSocketï¼‰

---

## é–‹ç™ºç’°å¢ƒ

### èµ·å‹•æ–¹æ³•

```bash
# 1. Dockerç’°å¢ƒèµ·å‹•
cd sns-platform
docker-compose up -d

# 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
cd backend
npm run dev

# 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
cd frontend
npm run dev
```

### å‹•ä½œç¢ºèª URL

- Backend: http://localhost:8000/health
- Frontend: http://localhost:3000
- Prisma Studio: `npx prisma studio` â†’ http://localhost:5555

### ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£
npx prisma studio             # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶
npx prisma generate           # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå†ç”Ÿæˆ
npx prisma migrate dev        # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

# APIå‹•ä½œç¢ºèªï¼ˆå®Ÿè£…å¾Œï¼‰
curl http://localhost:8000/health
curl http://localhost:8000/api/users

# Dockeræ“ä½œ
docker-compose logs -f db     # DBãƒ­ã‚°ç¢ºèª
docker-compose down           # ç’°å¢ƒåœæ­¢
```

---

## å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆãƒ»å®Ÿè£…ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ

### ğŸ¯ TypeScript ã®æ´»ç”¨

#### ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹å‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

```typescript
Request<P, ResBody, ReqBody, ReqQuery>
        â†‘    â†‘       â†‘       â†‘
        |    |       |       â””â”€ ?page=1&limit=10
        |    |       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ { "email": "..." }
        |    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã®å‹
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ /users/:id ã® :id éƒ¨åˆ†
```

#### Type Guards ã®å®Ÿè£…

```typescript
export function isCreateUserRequest(obj: unknown): obj is CreateUserRequest {
  if (typeof obj !== "object" || obj === null) return false;

  const req = obj as Record<string, unknown>;
  return (
    typeof req.email === "string" &&
    typeof req.username === "string" &&
    typeof req.displayName === "string"
  );
}
```

#### Null å®‰å…¨æ€§

```typescript
// Early Return ã«ã‚ˆã‚‹å‹çµã‚Šè¾¼ã¿
if (!user) {
  res.status(404).json(errorResponse);
  return; // â† é‡è¦ï¼šã“ã‚Œã«ã‚ˆã‚Šä»¥é™ã§userã¯non-null
}

// ã“ã®æ™‚ç‚¹ã§ user ã¯ Userå‹ï¼ˆnullã§ã¯ãªã„ï¼‰
const response: GetUserResponse = {
  success: true,
  data: user, // âœ… å‹ã‚¨ãƒ©ãƒ¼ãªã—
};
```

### ğŸ”§ Prisma ã®æ´»ç”¨

#### é¸æŠçš„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å–å¾—

```typescript
select: {
  id: true,
  username: true,
  displayName: true,
  // email ã‚’æ„å›³çš„ã«é™¤å¤–ã—ã¦ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Š
}
```

#### é–¢é€£ãƒ‡ãƒ¼ã‚¿ã®å–å¾—

```typescript
include: {
  _count: {
    select: {
      posts: true,
      followers: true,
      following: true,
    },
  },
}
```

### ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

#### ä¸¦åˆ—å‡¦ç†

```typescript
// 2ã¤ã®ã‚¯ã‚¨ãƒªã‚’åŒæ™‚å®Ÿè¡Œ
const [users, totalCount] = await Promise.all([
  prisma.user.findMany({...}),
  prisma.user.count(),
]);
```

#### åŠ¹ç‡çš„ãªãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³

```typescript
// skip/take ã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªå®Ÿè£…
skip: (page - 1) * limit,
take: limit,
orderBy: { createdAt: "desc" },
```

---

## ä»Šå¾Œã®èª²é¡Œãƒ»æ”¹å–„ç‚¹

### ğŸ”„ çŸ­æœŸçš„ãªæ”¹å–„

1. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–**: Zod ç­‰ã‚’ä½¿ç”¨ã—ãŸå…¥åŠ›å€¤æ¤œè¨¼
2. **ãƒ­ã‚°ç®¡ç†**: Winston ç­‰ã‚’ä½¿ç”¨ã—ãŸæ§‹é€ åŒ–ãƒ­ã‚°
3. **ãƒ†ã‚¹ãƒˆå®Ÿè£…**: Jest ç­‰ã‚’ä½¿ç”¨ã—ãŸå˜ä½“ãƒ»çµ±åˆãƒ†ã‚¹ãƒˆ

### ğŸš€ ä¸­é•·æœŸçš„ãªæ‹¡å¼µ

1. **ç›£è¦–ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹**: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®å……å®Ÿ
2. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã€CORS è¨­å®šã®æœ€é©åŒ–
3. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: Redis ç­‰ã‚’ä½¿ç”¨ã—ãŸãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š

---

## å®Ÿè£…å®Œäº†ã®ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ ğŸ‰

### âœ… é”æˆæ¸ˆã¿

- [x] **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤æ§‹ç¯‰** - Docker, PostgreSQL, Prisma
- [x] **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ** - å®Œå…¨ãª ER å›³ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- [x] **å‹å®šç¾©ã‚·ã‚¹ãƒ†ãƒ ** - åŒ…æ‹¬çš„ãªå‹å®‰å…¨æ€§
- [x] **User Controller** - 5 ã¤ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Œå…¨å®Ÿè£…
- [x] **ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹é©ç”¨** - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€å‹å®‰å…¨æ€§

### ğŸ”„ æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º

ã“ã‚Œã§ **User ç®¡ç†æ©Ÿèƒ½** ã®**ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å±¤ã¨å‹å®šç¾©**ãŒå®Œå…¨ã«å®Œæˆã—ã¾ã—ãŸã€‚

æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ï¼š

1. **ãƒ«ãƒ¼ãƒˆå±¤ã®å®Ÿè£…** - Express Router ã®è¨­å®š
2. **API çµ±åˆãƒ†ã‚¹ãƒˆ** - å®Ÿéš›ã®å‹•ä½œç¢ºèª
3. **Post ç®¡ç†æ©Ÿèƒ½** - æ¬¡ã®ä¸»è¦æ©Ÿèƒ½ã®å®Ÿè£…

SNS ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®æ ¸ã¨ãªã‚‹ User ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…ãŒã€æœ€æ–°ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å¾“ã£ã¦å®Œæˆã—ã¾ã—ãŸï¼ ğŸš€
